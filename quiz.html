<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quiz de Actualidad - Noticias Reales</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üì∞</text></svg>">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: #333;
            line-height: 1.4;
            min-height: 100vh;
            padding: 15px;
            overflow-x: hidden;
        }

        .container {
            max-width: 100%;
            margin: 0 auto;
            height: calc(85vh - 20px);
            display: flex;
            flex-direction: column;
        }

        .screen {
            display: none;
            background: white;
            border-radius: 15px;
            padding: 15px;
            box-shadow: 0 8px 25px rgba(0,0,0,0.2);
            animation: fadeIn 0.5s ease;
            flex: 1;
            overflow-y: auto;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .active {
            display: flex;
            flex-direction: column;
        }

        h1 {
            text-align: center;
            margin-bottom: 15px;
            color: #2c3e50;
            font-size: 24px;
            font-weight: 700;
        }

        /* PANTALLA INICIO COMPACTA */
        #start-screen {
            text-align: center;
            justify-content: center;
            gap: 12px;
        }

        #start-screen p {
            font-size: 15px;
            margin-bottom: 8px;
            color: #555;
        }

        .feature-list {
            margin: 12px 0;
            background: #f8f9fa;
            padding: 12px;
            border-radius: 10px;
            border-left: 4px solid #3498db;
        }

        .feature {
            display: flex;
            align-items: center;
            margin: 8px 0;
            font-size: 16px;
        }

        .feature .icon {
            font-size: 18px;
            margin-right: 10px;
            width: 25px;
            text-align: center;
        }

        .demo-note {
            text-align: center;
            margin-top: 15px;
            padding: 8px;
            background: #fff3cd;
            border-radius: 6px;
            border: 1px solid #ffeaa7;
            font-size: 12px;
        }

        /* PANTALLA QUIZ COMPACTA */
        .quiz-header {
            margin-bottom: 15px;
        }

        .progress {
            height: 8px;
            background: #ecf0f1;
            border-radius: 4px;
            margin-bottom: 10px;
            overflow: hidden;
        }

        .progress-bar {
            height: 100%;
            background: linear-gradient(90deg, #3498db, #2ecc71);
            width: 0%;
            transition: width 0.5s ease;
            border-radius: 4px;
        }

        .progress-text {
            text-align: center;
            margin-bottom: 10px;
            font-weight: 600;
            color: #7f8c8d;
            font-size: 14px;
        }

        .question-image {
            width: 100%;
            height: 156px;
            object-fit: cover;
            border-radius: 10px;
            margin-bottom: 12px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
            border: 2px solid white;
            background: #f8f9fa;
        }

        .question-text {
            font-size: 15px;
            margin-bottom: 12px;
            font-weight: 600;
            line-height: 1.4;
            color: #2c3e50;
            text-align: center;
            flex-shrink: 0;
        }

        .options {
            display: flex;
            flex-direction: column;
            gap: 8px;
            margin-bottom: 15px;
            flex: 1;
            overflow-y: auto;
        }

        .option {
            padding: 12px 14px;
    background: #ffffff; /* era #f8f9fa - ahora blanco puro */
            border: 2px solid #d1d8e0;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 15px;
            font-weight: 500;
            flex-shrink: 0;
                box-shadow: 0 2px 5px rgba(0,0,0,0.1); /* agregar sombra para mejor contraste */

        }

        .option:hover {
            background: #f0f8ff;
            transform: translateY(-2px);
                border-color: #3498db; /* agregar borde azul al hover */

        }

        .option.selected {
            background: #3498db;
            color: white;
            border-color: #3498db;
            transform: translateY(-1px);
        }

        .option.correct {
            background: #2ecc71;
            color: white;
            border-color: #2ecc71;
        }

        .option.incorrect {
            background: #e74c3c;
            color: white;
            border-color: #e74c3c;
        }

        /* BOTONES COMPACTOS */
        .button {
            display: block;
            width: 100%;
            padding: 14px;
            background: #2ecc71;
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 15px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            flex-shrink: 0;
            margin-top: auto;
        }

        .button:hover {
            background: #27ae60;
            transform: translateY(-2px);
        }

        .button:disabled {
            background: #bdc3c7;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .button.restart {
            background: #3498db;
        }

        .button.restart:hover {
            background: #2980b9;
        }

        .button.share {
            background: #9b59b6;
            margin-top: 10px;
        }

        .button.share:hover {
            background: #8e44ad;
        }

        /* PANTALLA RESULTADOS COMPACTA */
        #result-screen {
            text-align: center;
            justify-content: center;
            gap: 15px;
        }

        .score-display {
            margin: 20px 0;
        }

        .score-circle {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            background: linear-gradient(135deg, #3498db, #2ecc71);
            color: white;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            margin: 0 auto 20px;
            font-size: 28px;
            font-weight: bold;
            box-shadow: 0 8px 20px rgba(0,0,0,0.2);
            border: 4px solid white;
        }

        .score-circle small {
            font-size: 14px;
            font-weight: normal;
            margin-top: 2px;
        }

        .score-text {
            font-size: 18px;
            font-weight: 600;
            margin: 15px 0;
            color: #2c3e50;
        }

        .result-message {
            font-size: 15px;
            margin: 15px 0;
            color: #7f8c8d;
            line-height: 1.4;
        }

        .result-actions {
            margin: 20px 0;
        }

        .news-source {
            margin-top: 15px;
            padding: 12px;
            background: #f8f9fa;
            border-radius: 8px;
            font-size: 12px;
        }

        /* PANTALLA CARGA COMPACTA */
        .loading {
            text-align: center;
            padding: 30px 20px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            flex: 1;
        }

        .spinner {
            border: 5px solid rgba(52, 152, 219, 0.2);
            border-left-color: #3498db;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1.2s linear infinite;
            margin-bottom: 15px;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* FOOTER COMPACTO */
        footer {
            text-align: center;
            color: white;
            margin-top: 10px;
            font-size: 12px;
            opacity: 0.8;
        }

        /* RESPONSIVE ADICIONAL */
        @media (max-height: 650px) {
            .container {
                height: auto;
                min-height: 100vh;
            }
            
            .question-image {
                height: 130px;
            }
            
            .options {
                gap: 6px;
            }
            
            .option {
                padding: 10px 12px;
                font-size: 13px;
            }
            
            .button {
                padding: 14px;
                font-size: 15px;
            }
            
            .score-circle {
                width: 80px;
                height: 80px;
                font-size: 24px;
            }
        }

        @media (max-height: 600px) {
            .screen {
                padding: 15px;
            }
            
            h1 {
                font-size: 22px;
                margin-bottom: 10px;
            }
            
            .question-image {
                height: 110px;
                margin-bottom: 10px;
            }
            
            .question-text {
                font-size: 15px;
                margin-bottom: 10px;
            }
            
            .feature-list {
                padding: 10px;
                margin: 10px 0;
            }
            
            .feature {
                margin: 6px 0;
                font-size: 13px;
            }
        }

        /* Scroll suave para opciones si es necesario */
        .options::-webkit-scrollbar {
            width: 4px;
        }

        .options::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 2px;
        }

        .options::-webkit-scrollbar-thumb {
            background: #c1c1c1;
            border-radius: 2px;
        }

        .options::-webkit-scrollbar-thumb:hover {
            background: #a8a8a8;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Pantalla de inicio -->
        <div id="start-screen" class="screen active">
            <h1>üì∞ Quiz de Actualidad</h1>
            <p>Pon a prueba tus conocimientos con noticias reales</p>
            <div class="feature-list">
                <div class="feature">
                    <span class="icon">üîç</span>
                    <span>Noticias en tiempo real</span>
                </div>
                <div class="feature">
                    <span class="icon">üéØ</span>
                    <span>10 preguntas desafiantes</span>
                </div>
            </div>
            <button id="start-btn" class="button">Comenzar Quiz</button>
        </div>
        
        <!-- Pantalla de carga -->
        <div id="loading-screen" class="screen">
            <div class="loading">
                <div class="spinner"></div>
                <p>Cargando noticias actuales...</p>
                <p>Esto puede tomar unos segundos</p>
            </div>
        </div>
        
        <!-- Pantalla de preguntas -->
        <div id="quiz-screen" class="screen">
            <div class="quiz-header">
                <div class="progress-text">Pregunta <span id="current-question">1</span> de 10</div>
                <div class="progress">
                    <div class="progress-bar" id="progress-bar"></div>
                </div>
            </div>
            
            <div class="question-container">
                <img id="question-image" class="question-image" src="" alt="Imagen de la noticia">
                <div id="question-text" class="question-text"></div>
                <div id="options" class="options"></div>
            </div>
            
            <button id="next-btn" class="button" disabled>Siguiente</button>
        </div>
        
        <!-- Pantalla de resultados -->
        <div id="result-screen" class="screen">
            <h1>üéâ Resultados</h1>
            <div class="result">
                <p>Has completado el quiz de actualidad</p>
                <div class="score-display">
                    <div class="score-circle" id="score-circle">
                        <span id="score-value">0</span>
                        <small>/10</small>
                    </div>
                </div>
                <div id="score-text" class="score-text"></div>
                <p id="result-message" class="result-message"></p>
                <div class="result-actions">
                    <button id="restart-btn" class="button restart">üîÑ Jugar de nuevo</button>
                    <button id="share-btn" class="button share">üì§ Compartir resultado</button>
                </div>
                <div class="news-source">
                    <small>Fuente: Noticias reales - <a href="#" id="setup-link">Informaci√≥n</a></small>
                </div>
            </div>
        </div>
    </div>

    <footer>
        <p>Quiz de Actualidad &copy; 2023 - v4.4 - Noticias Reales</p>
        <p id="version-info" style="font-size: 12px; opacity: 0.7;"></p>
    </footer>

<script>
    // =============================================
    // QUIZ DE ACTUALIDAD - v4.4 - IM√ÅGENES GARANTIZADAS
    // √öltima actualizaci√≥n: 2024-01-15
    // =============================================

    // Variables globales
    let questions = [];
    let currentQuestionIndex = 0;
    let score = 0;
    let selectedOption = null;

    // Elementos del DOM
    let startScreen, loadingScreen, quizScreen, resultScreen;
    let startBtn, nextBtn, restartBtn, shareBtn;
    let questionImage, questionText, optionsContainer;
    let progressBar, currentQuestionElement, scoreValue, scoreText, resultMessage, setupLink;

    // Funci√≥n para obtener fecha actual
    function getCurrentDate() {
        const now = new Date();
        const year = now.getFullYear();
        const month = String(now.getMonth() + 1).padStart(2, '0');
        const day = String(now.getDate()).padStart(2, '0');
        return `${year}-${month}-${day}`;
    }

    // Funci√≥n para inicializar elementos DOM con validaci√≥n
    function initializeDOMElements() {
        console.log('üîç v4.4 - Inicializando elementos DOM...');
        
        // Pantallas
        startScreen = document.getElementById('start-screen');
        loadingScreen = document.getElementById('loading-screen');
        quizScreen = document.getElementById('quiz-screen');
        resultScreen = document.getElementById('result-screen');
        
        // Botones
        startBtn = document.getElementById('start-btn');
        nextBtn = document.getElementById('next-btn');
        restartBtn = document.getElementById('restart-btn');
        shareBtn = document.getElementById('share-btn');
        
        // Elementos de preguntas
        questionImage = document.getElementById('question-image');
        questionText = document.getElementById('question-text');
        optionsContainer = document.getElementById('options');
        
        // Elementos de progreso y resultados
        progressBar = document.getElementById('progress-bar');
        currentQuestionElement = document.getElementById('current-question');
        scoreValue = document.getElementById('score-value');
        scoreText = document.getElementById('score-text');
        resultMessage = document.getElementById('result-message');
        setupLink = document.getElementById('setup-link');
        
        // Validar elementos cr√≠ticos
        const criticalElements = [
            { name: 'startScreen', element: startScreen },
            { name: 'loadingScreen', element: loadingScreen },
            { name: 'quizScreen', element: quizScreen },
            { name: 'resultScreen', element: resultScreen },
            { name: 'startBtn', element: startBtn },
            { name: 'nextBtn', element: nextBtn }
        ];

        let missingElements = [];
        criticalElements.forEach(item => {
            if (!item.element) {
                missingElements.push(item.name);
            }
        });

        if (missingElements.length > 0) {
            console.error('‚ùå v4.4 - Elementos faltantes:', missingElements);
            throw new Error(`Faltan elementos cr√≠ticos: ${missingElements.join(', ')}`);
        }
        
        console.log('‚úÖ v4.4 - Todos los elementos DOM inicializados correctamente');
    }

    // Funci√≥n para configurar event listeners
    function setupEventListeners() {
        console.log('üéØ v4.4 - Configurando event listeners...');
        
        if (startBtn) {
            startBtn.addEventListener('click', startQuiz);
            console.log('‚úÖ Listener agregado: startBtn');
        }
        
        if (nextBtn) {
            nextBtn.addEventListener('click', nextQuestion);
            console.log('‚úÖ Listener agregado: nextBtn');
        }
        
        if (restartBtn) {
            restartBtn.addEventListener('click', restartQuiz);
            console.log('‚úÖ Listener agregado: restartBtn');
        }
        
        if (shareBtn) {
            shareBtn.addEventListener('click', shareResults);
            console.log('‚úÖ Listener agregado: shareBtn');
        }
        
        if (setupLink) {
            setupLink.addEventListener('click', showSetupGuide);
            console.log('‚úÖ Listener agregado: setupLink');
        }
        
        console.log('‚úÖ v4.4 - Todos los event listeners configurados');
    }

    // üîç FUNCI√ìN PARA VERIFICACI√ìN R√ÅPIDA DE IM√ÅGENES
    function quickImageCheck(imageUrl) {
        if (!imageUrl || !imageUrl.startsWith('http')) {
            return false;
        }
        
        // Lista de dominios confiables
        const trustedDomains = [
            'unsplash.com', 'gettyimages', 'reuters.com', 'apnews.com',
            'bbc.co.uk', 'cnn.com', 'nytimes.com', 'elpa√≠s.com',
            'clarin.com', 'lanacion.com', 'infobae.com', 'elmundo.es',
            'abc.es', 'lavanguardia.com', 'elperiodico.com', '20minutos.es',
            'rtve.es', 'antena3.com', 'telecinco.es', 'lasexta.com',
            'mediotiempo.com', 'record.com.mx', 'milenio.com', 'excelsior.com.mx',
            'eluniversal.com.mx', 'granma.cu', 'telesurtv.net', 'dw.com'
        ];
        
        // Lista de dominios problem√°ticos
        const blockedDomains = [
            'placeholder', 'default', 'placehold.co', 'dummyimage.com',
            'via.placeholder.com', 'example.com', 'test.com'
        ];
        
        const isTrusted = trustedDomains.some(domain => imageUrl.includes(domain));
        const isBlocked = blockedDomains.some(domain => imageUrl.includes(domain));
        
        // Verificar extensi√≥n de archivo de imagen
        const imageExtensions = ['.jpg', '.jpeg', '.png', '.webp', '.gif', '.bmp'];
        const hasImageExtension = imageExtensions.some(ext => imageUrl.toLowerCase().includes(ext));
        
        // Verificar patrones comunes de CDN de im√°genes
        const hasImagePatterns = imageUrl.includes('/images/') || 
                               imageUrl.includes('/img/') || 
                               imageUrl.includes('/fotos/') ||
                               imageUrl.includes('/photo/') ||
                               imageUrl.includes('/imagenes/') ||
                               imageUrl.includes('/foto/') ||
                               imageUrl.includes('/photogallery/');
        
        return !isBlocked && (isTrusted || hasImageExtension || hasImagePatterns);
    }

    // Funci√≥n principal para cargar noticias reales
    async function loadRealNews() {
        const apiKey = 'cd358617b03acad6467b57dfe9cbdb81';
        
        console.log('üîÑ v4.4 - Cargando noticias reales con verificaci√≥n de im√°genes...');
        
        try {
            // VARIAR LAS CATEGOR√çAS para obtener noticias diferentes
            const categories = ['general', 'world', 'nation', 'business', 'technology', 'entertainment', 'sports', 'science', 'health'];
            const randomCategory = categories[Math.floor(Math.random() * categories.length)];
            
            // VARIAR EL PA√çS para m√°s diversidad
            const countries = ['ar', 'us'];
            const randomCountry = countries[Math.floor(Math.random() * countries.length)];
            
            const proxyUrl = 'https://api.allorigins.win/raw?url=';
            const targetUrl = `https://gnews.io/api/v4/top-headlines?token=${apiKey}&lang=es&max=30&category=${randomCategory}&country=${randomCountry}&from=${getCurrentDate()}`;
            
            console.log('üîó URL completa:', proxyUrl + encodeURIComponent(targetUrl));
            console.log(`üéØ Categor√≠a: ${randomCategory}, Pa√≠s: ${randomCountry}`);
            
            const response = await fetch(proxyUrl + encodeURIComponent(targetUrl), {
                method: 'GET',
                headers: {
                    'Accept': 'application/json',
                }
            });
            
            if (!response.ok) {
                throw new Error(`Error HTTP: ${response.status} - ${response.statusText}`);
            }
            
            const data = await response.json();
            
            console.log('‚úÖ v4.4 - Noticias recibidas correctamente');
            console.log('üìä Cantidad de art√≠culos brutos:', data.articles ? data.articles.length : 0);
            
            if (data.articles && data.articles.length > 0) {
                // FILTRADO RIGUROSO ANTES de generar preguntas
                const articlesWithImages = data.articles.filter(article => 
                    quickImageCheck(article.image) && 
                    article.title && 
                    article.title.length > 15
                );
                
                console.log(`üìä Art√≠culos con im√°genes v√°lidas: ${articlesWithImages.length}`);
                
                if (articlesWithImages.length >= 3) {
                    const generatedQuestions = generateQuestionsFromArticles(articlesWithImages);
                    console.log(`‚úÖ v4.4 - Preguntas generadas con im√°genes: ${generatedQuestions.length}`);
                    return generatedQuestions;
                } else {
                    console.log('üîÑ No hay suficientes art√≠culos con im√°genes, intentando categor√≠a general...');
                    return await loadGeneralNewsFallback(apiKey);
                }
            } else {
                throw new Error('No se encontraron noticias en la respuesta de la API');
            }
        } catch (error) {
            console.error('‚ùå v4.4 - Error cargando noticias reales:', error);
            throw new Error('No se pudieron cargar noticias reales. Intenta m√°s tarde.');
        }
    }

    // Funci√≥n de fallback para categor√≠a general
    async function loadGeneralNewsFallback(apiKey) {
        const proxyUrl = 'https://api.allorigins.win/raw?url=';
        const targetUrl = `https://gnews.io/api/v4/top-headlines?token=${apiKey}&lang=es&max=30&country=ar&from=${getCurrentDate()}`;
        const response = await fetch(proxyUrl + encodeURIComponent(targetUrl));
        const data = await response.json();
        
        if (data.articles && data.articles.length > 0) {
            const articlesWithImages = data.articles.filter(article => 
                quickImageCheck(article.image) && 
                article.title && 
                article.title.length > 15
            );
            
            if (articlesWithImages.length >= 3) {
                return generateQuestionsFromArticles(articlesWithImages);
            }
        }
        
        throw new Error('No se pudieron cargar noticias con im√°genes v√°lidas');
    }

    // Generar preguntas a partir de art√≠culos reales
// Generar preguntas a partir de art√≠culos reales - VERSI√ìN MEJORADA PARA 10 PREGUNTAS
function generateQuestionsFromArticles(articles) {
    console.log('üìù v4.4 - Procesando art√≠culos reales para 10 preguntas...');
    
    // MEZCLAR LOS ART√çCULOS antes de filtrar
    const shuffledArticles = [...articles];
    for (let i = shuffledArticles.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [shuffledArticles[i], shuffledArticles[j]] = [shuffledArticles[j], shuffledArticles[i]];
    }
    
    // VERIFICACI√ìN RIGUROSA de im√°genes y t√≠tulos - TOMAR HASTA 10 ART√çCULOS
    const validArticles = [];
    
    for (const article of shuffledArticles) {
        if (validArticles.length >= 10) break; // Detener cuando tengamos 10
        
        const imageCheck = quickImageCheck(article.image);
        const titleCheck = article.title && 
                          article.title.length > 15 &&
                          !article.title.includes('undefined');
        
        if (imageCheck && titleCheck) {
            console.log(`‚úÖ Art√≠culo v√°lido: "${article.title.substring(0, 50)}..."`);
            console.log(`   üñºÔ∏è Imagen: ${article.image}`);
            validArticles.push(article);
        } else {
            console.log(`‚ùå Art√≠culo descartado: "${article.title?.substring(0, 50)}..."`);
        }
    }
    
    console.log(`‚úÖ v4.4 - Art√≠culos v√°lidos encontrados: ${validArticles.length}`);
    
    // üî• NUEVO: SI NO HAY SUFICIENTES ART√çCULOS, USAR LOS MISMOS PERO MEZCLADOS DIFERENTE
    if (validArticles.length < 10) {
        console.log(`üîÑ v4.4 - Solo ${validArticles.length} art√≠culos v√°lidos. Reutilizando para completar 10 preguntas...`);
        
        // Crear array de 10 preguntas reutilizando los art√≠culos v√°lidos
        const questions = [];
        for (let i = 0; i < 10; i++) {
            const articleIndex = i % validArticles.length;
            const article = validArticles[articleIndex];
            
            // Crear opciones incorrectas de otros art√≠culos
            const otherArticles = validArticles.filter((_, idx) => idx !== articleIndex);
            
            // MEZCLAR LOS ART√çCULOS PARA OPCIONES INCORRECTAS
            const shuffledOthers = [...otherArticles];
            for (let j = shuffledOthers.length - 1; j > 0; j--) {
                const k = Math.floor(Math.random() * (j + 1));
                [shuffledOthers[j], shuffledOthers[k]] = [shuffledOthers[k], shuffledOthers[j]];
            }

            const incorrectOptions = [];
            const usedTitles = new Set();

            // Tomar 2 t√≠tulos de otros art√≠culos como opciones incorrectas
            for (let j = 0; j < shuffledOthers.length && incorrectOptions.length < 2; j++) {
                let wrongTitle = shuffledOthers[j].title;
                wrongTitle = cleanTitle(wrongTitle);
                if (wrongTitle.length > 80) {
                    wrongTitle = wrongTitle.substring(0, 77) + '...';
                }
                
                // Verificar que no sea repetido
                if (!usedTitles.has(wrongTitle)) {
                    incorrectOptions.push(wrongTitle);
                    usedTitles.add(wrongTitle);
                }
            }
            
            // Si a√∫n no tenemos suficientes opciones incorrectas, crear algunas gen√©ricas
            while (incorrectOptions.length < 2) {
                const genericOptions = [
                    "Evento internacional relevante",
                    "Noticia de actualidad mundial",
                    "Suceso pol√≠tico importante",
                    "Desarrollo econ√≥mico reciente"
                ];
                const randomOption = genericOptions[Math.floor(Math.random() * genericOptions.length)];
                if (!usedTitles.has(randomOption)) {
                    incorrectOptions.push(randomOption);
                    usedTitles.add(randomOption);
                }
            }
            
            // Preparar t√≠tulo correcto
            let correctTitle = cleanTitle(article.title);
            if (correctTitle.length > 80) {
                correctTitle = correctTitle.substring(0, 77) + '...';
            }
            
            // Mezclar opciones
            const options = [correctTitle, ...incorrectOptions];
            shuffleArray(options);
            
            const correctAnswerIndex = options.indexOf(correctTitle);
            
            console.log(`‚ùì v4.4 - Pregunta ${i + 1}: "${correctTitle.substring(0, 50)}..." (Art√≠culo ${articleIndex + 1})`);
            
            questions.push({
                question: "¬øCu√°l es el titular correcto para esta noticia?",
                image: article.image,
                options: options,
                correctAnswer: correctAnswerIndex,
                source: article.source?.name || "Medios Internacionales",
                hasValidImage: true
            });
        }
        
        return questions;
    }
    
    // Si tenemos 10 o m√°s art√≠culos, proceder normalmente
    return validArticles.slice(0, 10).map((article, index) => {
        // Crear opciones incorrectas de otros art√≠culos VERIFICADOS
        const otherArticles = validArticles.filter((_, i) => i !== index);
        
        // MEZCLAR LOS ART√çCULOS PARA OPCIONES INCORRECTAS
        const shuffledOthers = [...otherArticles];
        for (let i = shuffledOthers.length - 1; i > 0; i--) {
            const j = Math.floor(Math.random() * (i + 1));
            [shuffledOthers[i], shuffledOthers[j]] = [shuffledOthers[j], shuffledOthers[i]];
        }

        const incorrectOptions = [];
        const usedTitles = new Set();

        // Tomar 2 t√≠tulos de otros art√≠culos como opciones incorrectas
        for (let i = 0; i < shuffledOthers.length && incorrectOptions.length < 2; i++) {
            let wrongTitle = shuffledOthers[i].title;
            wrongTitle = cleanTitle(wrongTitle);
            if (wrongTitle.length > 80) {
                wrongTitle = wrongTitle.substring(0, 77) + '...';
            }
            
            // Verificar que no sea repetido
            if (!usedTitles.has(wrongTitle)) {
                incorrectOptions.push(wrongTitle);
                usedTitles.add(wrongTitle);
            }
        }
        
        // Preparar t√≠tulo correcto
        let correctTitle = cleanTitle(article.title);
        if (correctTitle.length > 80) {
            correctTitle = correctTitle.substring(0, 77) + '...';
        }
        
        // Mezclar opciones
        const options = [correctTitle, ...incorrectOptions];
        shuffleArray(options);
        
        const correctAnswerIndex = options.indexOf(correctTitle);
        
        console.log(`‚ùì v4.4 - Pregunta ${index + 1}: "${correctTitle.substring(0, 50)}..."`);
        console.log(`   üñºÔ∏è Imagen confirmada: ${article.image}`);
        
        return {
            question: "¬øCu√°l es el titular correcto para esta noticia?",
            image: article.image,
            options: options,
            correctAnswer: correctAnswerIndex,
            source: article.source?.name || "Medios Internacionales",
            hasValidImage: true
        };
    });
}

    // Limpiar t√≠tulo de la noticia
    function cleanTitle(title) {
        return title
            .replace(/\[.*?\]/g, '')
            .replace(/\(.*?\)/g, '')
            .replace(/ - .*$/, '')
            .replace(/\.$/, '')
            .trim();
    }

    // Funci√≥n para mezclar array
    function shuffleArray(array) {
        for (let i = array.length - 1; i > 0; i--) {
            const j = Math.floor(Math.random() * (i + 1));
            [array[i], array[j]] = [array[j], array[i]];
        }
        return array;
    }

    // Iniciar el quiz
    async function startQuiz() {
        console.log('üöÄ v4.4 - Iniciando quiz con noticias reales...');
        
        if (!startScreen || !loadingScreen || !quizScreen) {
            console.error('‚ùå v4.4 - Error: Pantallas no inicializadas');
            return;
        }
        
        startScreen.classList.remove('active');
        loadingScreen.classList.add('active');
        
        // Reiniciar variables
        currentQuestionIndex = 0;
        score = 0;
        selectedOption = null;
        
        try {
            await loadQuestions();
            loadingScreen.classList.remove('active');
            quizScreen.classList.add('active');
            showQuestion();
        } catch (error) {
            console.error('‚ùå v4.4 - Error cr√≠tico:', error);
            if (loadingScreen) loadingScreen.classList.remove('active');
            if (startScreen) startScreen.classList.add('active');
            alert('‚ùå No se pudieron cargar noticias reales en este momento. El servicio puede estar temporalmente no disponible. Intenta m√°s tarde.');
        }
    }

    // Cargar preguntas
    async function loadQuestions() {
        console.log('üì° v4.4 - Conectando con API de noticias...');
        questions = await loadRealNews();
        
        if (questions.length === 0) {
            throw new Error('No se pudieron generar preguntas desde la API');
        }
        
        shuffleArray(questions);
        console.log(`‚úÖ v4.4 - ${questions.length} preguntas reales cargadas exitosamente`);
    }

    // Mostrar la pregunta actual
    function showQuestion() {
        if (!questions[currentQuestionIndex]) {
            console.error('‚ùå v4.4 - Error: No hay pregunta para mostrar');
            return;
        }
        
        const question = questions[currentQuestionIndex];
        
        console.log(`üìÑ v4.4 - Mostrando noticia real ${currentQuestionIndex + 1}`);
        
        // Validar y establecer elementos
        if (questionImage) {
            questionImage.src = question.image;
            questionImage.alt = "Imagen de la noticia real";
            questionImage.onerror = function() {
                console.log('üñºÔ∏è v4.4 - Imagen no disponible, usando placeholder mejorado');
                this.src = 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNDAwIiBoZWlnaHQ9IjIyMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSIjZjhmOGY4Ii8+PGNpcmNsZSBjeD0iMjAwIiBjeT0iODAiIHI9IjMwIiBmaWxsPSIjZGRkIi8+PHJlY3QgeD0iMTUwIiB5PSIxMjAiIHdpZHRoPSIxMDAiIGhlaWdodD0iMTUiIHJ4PSI3IiBmaWxsPSIjZGRkIi8+PHRleHQgeD0iMjAwIiB5PSIxODAiIGZvbnQtZmFtaWx5PSJBcmlhbCwgc2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgZmlsbD0iIzk5OSIgdGV4dC1hbmNob3I9Im1pZGRsZSI+Tm90aWNpYSByZWFsPC90ZXh0Pjwvc3ZnPg==';
                this.alt = "Imagen de noticia no disponible";
            };
        }
        
        if (questionText) {
            questionText.textContent = question.question;
        }
        
        if (optionsContainer) {
            optionsContainer.innerHTML = '';
            question.options.forEach((option, index) => {
                const optionElement = document.createElement('div');
                optionElement.className = 'option';
                optionElement.textContent = option;
                optionElement.dataset.index = index;
                optionElement.addEventListener('click', selectOption);
                optionsContainer.appendChild(optionElement);
            });
        }
        
        // Actualizar progreso
        if (progressBar) {
            const progress = ((currentQuestionIndex + 1) / questions.length) * 100;
            progressBar.style.width = `${progress}%`;
        }
        
        if (currentQuestionElement) {
            currentQuestionElement.textContent = currentQuestionIndex + 1;
        }
        
        // Reiniciar estado
        selectedOption = null;
        if (nextBtn) {
            nextBtn.disabled = true;
            nextBtn.textContent = currentQuestionIndex < questions.length - 1 ? "Siguiente" : "Ver resultados";
        }
    }

    // Seleccionar una opci√≥n
    function selectOption(e) {
        if (selectedOption !== null) return;
        
        const options = document.querySelectorAll('.option');
        options.forEach(option => option.classList.remove('selected'));
        
        e.target.classList.add('selected');
        selectedOption = parseInt(e.target.dataset.index);
        
        if (nextBtn) {
            nextBtn.disabled = false;
        }
    }

    // Pasar a la siguiente pregunta
    function nextQuestion() {
        const correctAnswer = questions[currentQuestionIndex].correctAnswer;
        const options = document.querySelectorAll('.option');
        
        // Mostrar feedback visual
        options[correctAnswer].classList.add('correct');
        if (selectedOption !== correctAnswer) {
            options[selectedOption].classList.add('incorrect');
        } else {
            score++;
        }
        
        // Deshabilitar opciones
        options.forEach(option => {
            option.style.pointerEvents = 'none';
        });
        
        // Avanzar despu√©s de delay
        setTimeout(() => {
            currentQuestionIndex++;
            if (currentQuestionIndex < questions.length) {
                showQuestion();
            } else {
                showResults();
            }
        }, 1500);
    }

    // Mostrar resultados
    function showResults() {
        if (quizScreen) quizScreen.classList.remove('active');
        if (resultScreen) resultScreen.classList.add('active');
        
        if (scoreValue) scoreValue.textContent = score;
        if (scoreText) scoreText.textContent = `${score} de ${questions.length} correctas`;
        
        // Mensaje personalizado
        if (resultMessage) {
            if (score >= 8) {
                resultMessage.textContent = "¬°Excelente! Est√°s muy informado sobre las noticias actuales.";
            } else if (score >= 5) {
                resultMessage.textContent = "Buen trabajo. Mantente leyendo noticias para mejorar.";
            } else {
                resultMessage.textContent = "Sigue inform√°ndote. Las noticias cambian r√°pidamente.";
            }
        }
        
        console.log(`üéØ v4.4 - Quiz completado con noticias reales. Puntuaci√≥n: ${score}/${questions.length}`);
    }

    // Reiniciar el quiz
    function restartQuiz() {
        currentQuestionIndex = 0;
        score = 0;
        selectedOption = null;
        if (resultScreen) resultScreen.classList.remove('active');
        if (startScreen) startScreen.classList.add('active');
    }

    // Compartir resultados
    function shareResults() {
        const shareText = `¬°Acabo de completar el Quiz de Actualidad con noticias reales y obtuve ${score}/10! ¬øPuedes superar mi puntuaci√≥n?`;
        
        if (navigator.share) {
            navigator.share({
                title: 'Quiz de Actualidad - Noticias Reales',
                text: shareText,
                url: window.location.href
            });
        } else {
            navigator.clipboard.writeText(shareText).then(() => {
                alert('Resultado copiado. ¬°Comp√°rtelo!');
            });
        }
    }

    // Mostrar informaci√≥n de la API
    function showSetupGuide(e) {
        if (e) e.preventDefault();
        alert(`QUIZ DE ACTUALIDAD v4.4

‚úÖ MODO: NOTICIAS REALES
üåê Fuente: GNews API
üìä Preguntas generadas autom√°ticamente
üñºÔ∏è Im√°genes reales garantizadas

El quiz est√° funcionando con noticias actuales en tiempo real.`);
    }

    // Mostrar informaci√≥n de versi√≥n
    function showVersionInfo() {
        const versionInfo = document.getElementById('version-info');
        if (versionInfo) {
            versionInfo.textContent = `Versi√≥n: 4.4 | Noticias Reales | API: GNews`;
        }
        console.log('üîç QUIZ DE ACTUALIDAD - v4.4 - NOTICIAS REALES');
        console.log('üìÖ √öltima actualizaci√≥n: 2024-01-15');
        console.log('üåê Fuente: GNews API');
        console.log('‚úÖ MODO: Noticias reales en tiempo real');
        console.log('üñºÔ∏è GARANT√çA: Todas las preguntas tienen im√°genes v√°lidas');
        console.log('üöÄ Script cargado correctamente');
    }

    // Inicializar aplicaci√≥n
    function initializeApp() {
        try {
            console.log('üöÄ v4.4 - Inicializando aplicaci√≥n...');
            initializeDOMElements();
            setupEventListeners();
            showVersionInfo();
            console.log('‚úÖ v4.4 - Aplicaci√≥n inicializada correctamente');
        } catch (error) {
            console.error('‚ùå v4.4 - Error inicializando aplicaci√≥n:', error);
            alert('Error al cargar la aplicaci√≥n. Verifica la consola para m√°s detalles.');
        }
    }

    // Inicializar cuando el DOM est√© listo
    document.addEventListener('DOMContentLoaded', function() {
        console.log('üìÑ DOM cargado, iniciando aplicaci√≥n...');
        initializeApp();
    });
</script>
</body>
</html>
