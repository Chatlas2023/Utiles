<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Theremin por Proximidad</title>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background-color: #121212;
            color: #e0e0e0;
            line-height: 1.6;
            padding: 20px;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }
        
        .container {
            background-color: #1e1e1e;
            padding: 30px;
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.4);
            max-width: 500px;
            width: 90%;
            border: 1px solid #333;
        }
        
        h1 {
            color: #bb86fc;
            margin-top: 0;
            font-size: 24px;
            text-align: center;
            margin-bottom: 15px;
        }
        
        p {
            font-size: 16px;
            line-height: 1.6;
            margin-bottom: 15px;
        }
        
        .sensor-data {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin: 25px 0;
        }
        
        .data-box {
            background-color: #252525;
            padding: 15px;
            border-radius: 10px;
            border: 1px solid #333;
        }
        
        .data-label {
            font-size: 14px;
            margin-bottom: 5px;
            color: #bb86fc;
        }
        
        .data-value {
            font-size: 20px;
            font-weight: bold;
        }
        
        .instructions {
            background-color: #252525;
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
            text-align: left;
            border: 1px solid #333;
        }
        
        button {
            background-color: #bb86fc;
            color: #121212;
            border: none;
            padding: 15px 30px;
            font-size: 16px;
            border-radius: 50px;
            cursor: pointer;
            margin: 20px 0;
            font-weight: bold;
            transition: all 0.3s;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
            display: block;
            width: 100%;
        }
        
        button:hover {
            background-color: #a970f7;
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.4);
        }
        
        button:active {
            transform: translateY(0);
        }
        
        .warning {
            color: #cf6679;
            font-weight: bold;
            margin-top: 20px;
            text-align: center;
            font-size: 14px;
        }
        
        .frequency-bar {
            width: 100%;
            height: 20px;
            background-color: #252525;
            border-radius: 10px;
            overflow: hidden;
            margin: 15px 0;
            border: 1px solid #333;
        }
        
        .frequency-level {
            height: 100%;
            width: 50%;
            background: linear-gradient(90deg, #1a2a6c, #bb86fc);
            transition: width 0.3s;
        }
        
        .volume-bar {
            width: 100%;
            height: 20px;
            background-color: #252525;
            border-radius: 10px;
            overflow: hidden;
            margin: 15px 0;
            border: 1px solid #333;
        }
        
        .volume-level {
            height: 100%;
            width: 50%;
            background: linear-gradient(90deg, #1a2a6c, #cf6679);
            transition: width 0.3s;
        }
        
        .back-button {
            background-color: #333;
            color: #e0e0e0;
            padding: 10px 20px;
            font-size: 14px;
            margin-top: 20px;
            width: auto;
        }
        
        .back-button:hover {
            background-color: #444;
        }
        
        .proximity-demo {
            text-align: center;
            margin: 20px 0;
            position: relative;
            height: 150px;
        }
        
        .phone-icon {
            font-size: 60px;
            margin-bottom: 15px;
        }
        
        .hand-icon {
            font-size: 40px;
            position: absolute;
            top: 70px;
            left: 50%;
            transform: translateX(-50%);
            transition: top 0.5s ease;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Theremin por Proximidad</h1>
        
        <div class="instructions">
            <p>ðŸ”¹ Acerca y aleja tu mano del telÃ©fono para cambiar el tono</p>
            <p>ðŸ”¹ El volumen se controla con el botÃ³n deslizante debajo</p>
            <p>ðŸ”¹ Haz clic en "Comenzar" y acepta los permisos del sensor</p>
        </div>
        
        <div class="proximity-demo">
            <div class="phone-icon">ðŸ“±</div>
            <div class="hand-icon" id="handIcon">ðŸ‘‹</div>
        </div>
        
        <button id="startBtn">Comenzar</button>
        
        <div class="sensor-data">
            <div class="data-box">
                <div class="data-label">Proximidad</div>
                <div id="proximityValue" class="data-value">0%</div>
                <div class="frequency-bar">
                    <div id="proximityLevel" class="frequency-level"></div>
                </div>
            </div>
            
            <div class="data-box">
                <div class="data-label">Volumen</div>
                <div id="volumeValue" class="data-value">50%</div>
                <input type="range" id="volumeControl" min="0" max="100" value="50" class="volume-bar" style="width: 100%; height: 20px;">
            </div>
        </div>
        
        <div class="warning" id="warningMessage">
            Nota: Esta aplicaciÃ³n requiere un sensor de proximidad y puede no funcionar en todos los dispositivos.
        </div>
        
        <button class="back-button" onclick="window.location.href='index.html'">Volver a Utilidades</button>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const startBtn = document.getElementById('startBtn');
            const proximityValue = document.getElementById('proximityValue');
            const volumeValue = document.getElementById('volumeValue');
            const proximityLevel = document.getElementById('proximityLevel');
            const volumeControl = document.getElementById('volumeControl');
            const warningMessage = document.getElementById('warningMessage');
            const handIcon = document.getElementById('handIcon');
            
            let audioContext;
            let oscillator;
            let isPlaying = false;
            
            // Valores iniciales
            let proximity = 0;
            let volume = 0.5;
            
            // Inicializar audio
            function initAudio() {
                audioContext = new (window.AudioContext || window.webkitAudioContext)();
                oscillator = audioContext.createOscillator();
                oscillator.type = 'sine';
                oscillator.frequency.setValueAtTime(0, audioContext.currentTime);
                
                const gainNode = audioContext.createGain();
                gainNode.gain.setValueAtTime(volume, audioContext.currentTime);
                
                oscillator.connect(gainNode);
                gainNode.connect(audioContext.destination);
                
                oscillator.start();
                isPlaying = true;
                
                return gainNode;
            }
            
            let gainNode;
            
            // Actualizar el sonido basado en la proximidad
            function updateSound(proximityValue) {
                if (!isPlaying) return;
                
                // Convertir el valor de proximidad a frecuencia (200-1000 Hz)
                // Los valores tÃ­picos de proximidad son 0 (lejos) a 1 (cerca) o distancia en cm
                let pitch = 200 + proximityValue * 800;
                oscillator.frequency.setValueAtTime(pitch, audioContext.currentTime);
                
                // Actualizar el volumen desde el control deslizante
                gainNode.gain.setValueAtTime(volume, audioContext.currentTime);
                
                // Actualizar la interfaz
                proximityValueEl.textContent = Math.round(proximityValue * 100) + '%';
                proximityLevel.style.width = (proximityValue * 100) + '%';
                
                // Mover la mano en la visualizaciÃ³n
                handIcon.style.top = (70 + (1 - proximityValue) * 80) + 'px';
            }
            
            // Solicitar acceso a los sensores
            function requestSensorPermission() {
                if ('DeviceProximityEvent' in window || 'ondeviceproximity' in window) {
                    // El navegador soporta el sensor de proximidad
                    startSensors();
                } else if ('ProximitySensor' in window) {
                    // API genÃ©rica de sensores
                    try {
                        const sensor = new ProximitySensor();
                        sensor.start();
                        sensor.onreading = () => {
                            updateSound(sensor.value || sensor.distance);
                        };
                        sensor.onerror = (event) => {
                            warningMessage.textContent = 'Error al acceder al sensor de proximidad: ' + event.error.message;
                        };
                        startAudio();
                    } catch (error) {
                        warningMessage.textContent = 'Error al inicializar el sensor: ' + error.message;
                    }
                } else {
                    warningMessage.textContent = 'Tu navegador no soporta la API de Sensor de Proximidad.';
                }
            }
            
            // Iniciar el monitoreo de sensores
            function startSensors() {
                gainNode = initAudio();
                
                // Evento para dispositivos que soportan DeviceProximityEvent
                if ('ondeviceproximity' in window) {
                    window.addEventListener('deviceproximity', function(event) {
                        // El valor puede ser distance (cm) o value (0-1)
                        let proximityValue = event.value;
                        if (event.distance !== undefined) {
                            // Convertir distancia a un valor 0-1 (mÃ¡ximo 10 cm)
                            proximityValue = Math.max(0, 1 - (event.distance / 10));
                        }
                        updateSound(proximityValue);
                    });
                } 
                // Para navegadores que usan la Generic Sensor API
                else if ('ProximitySensor' in window) {
                    try {
                        const sensor = new ProximitySensor();
                        sensor.start();
                        sensor.onreading = () => {
                            let proximityValue = sensor.value;
                            if (sensor.distance !== null) {
                                proximityValue = Math.max(0, 1 - (sensor.distance / 10));
                            }
                            updateSound(proximityValue);
                        };
                    } catch (error) {
                        warningMessage.textContent = 'Error al acceder al sensor: ' + error.message;
                    }
                }
                
                // Control de volumen
                volumeControl.addEventListener('input', function() {
                    volume = this.value / 100;
                    volumeValue.textContent = this.value + '%';
                    if (gainNode) {
                        gainNode.gain.setValueAtTime(volume, audioContext.currentTime);
                    }
                });
                
                startBtn.textContent = 'Funcionando';
                startBtn.disabled = true;
                warningMessage.textContent = 'Â¡Funcionando! Acerca tu mano al telÃ©fono para generar sonidos.';
                warningMessage.style.color = '#03dac6';
            }
            
            // Iniciar solo el audio (para navegadores sin sensor de proximidad)
            function startAudio() {
                gainNode = initAudio();
                
                // Simular proximidad con el ratÃ³n para dispositivos sin sensor
                document.addEventListener('mousemove', function(e) {
                    const height = window.innerHeight;
                    const proximityValue = 1 - (e.clientY / height);
                    updateSound(proximityValue);
                });
                
                // Control de volumen
                volumeControl.addEventListener('input', function() {
                    volume = this.value / 100;
                    volumeValue.textContent = this.value + '%';
                    if (gainNode) {
                        gainNode.gain.setValueAtTime(volume, audioContext.currentTime);
                    }
                });
                
                startBtn.textContent = 'Funcionando (SimulaciÃ³n)';
                startBtn.disabled = true;
                warningMessage.textContent = 'Modo simulaciÃ³n: Mueve el ratÃ³n hacia arriba y abajo para controlar el tono.';
                warningMessage.style.color = '#03dac6';
            }
            
            // Evento para el botÃ³n de inicio
            startBtn.addEventListener('click', requestSensorPermission);
        });
    </script>
</body>
</html>
